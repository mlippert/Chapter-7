var bookConfig = {
    type: "book",
    url: "TOC.html",
    id: "TOC",
    title: "Organic Chemistry",
    children: [
    {
        type: "chapter",
        url: "chapter_7.html",
        id: "7",
        ordinal: "7",
        title: "Stereoisomerism",
        children: [
        {
            type: "module",
            url: "module_7.1.html",
            id: "7.1",
            title: "Stereoisomerism",
            children: [
            {
                type: "objective",
                url: "section_7.1.1.html",
                id: "7.1.1",
                title: "Stereoisomerism in Alkenes"
            },
            {
                type: "objective",
                url: "section_7.1.2.html",
                id: "7.1.2",
                title: "Stereoisomerism at Tetrahedral Carbon"
            },
            {
                type: "objective",
                url: "section_7.1.3.html",
                id: "7.1.3",
                title: "Stereoisomerism in Allenes"
            },
            {
                type: "objective",
                url: "section_7.1.4.html",
                id: "7.1.4",
                title: "Stereoisomerism in Biphenyl and Related Derivatives"
            },
			{
                type: "objective",
                url: "section_7.1.5.html",
                id: "7.1.5",
                title: "Stereocenters Involving Heteroatoms"
            },
            ]
        },
        {
            type: "module",
            url: "module_7.2.html",
            id: "7.2",
            title: "Sequence Rules and Assignment of Configuration",
            children: [
            {
                type: "objective",
                url: "section_7.2.1.html",
                id: "7.2.1",
                title: "The Cahn-Ingold-Prelog (CIP) Sequence Rules"
            },
            {
                type: "objective",
                url: "section_7.2.2.html",
                id: "7.2.2",
                title: "E and Z Descriptors"
            },
            {
                type: "objective",
                url: "section_7.2.3.html",
                id: "7.2.3",
                title: "R and S Descriptors"
            },
            {
                type: "objective",
                url: "section_7.2.4.html",
                id: "7.2.4",
                title: "Ra and Sa Descriptors"
            },
            {
                type: "objective",
                url: "section_7.2.5.html",
                id: "7.2.5",
                title: "Fischer Projections"
            },
            ]
        },
        {
            type: "module",
            url: "module_7.3.html",
            id: "7.3",
            title: "Chirality",
            children: [
            {
                type: "objective",
                url: "section_7.3.1.html",
                id: "7.3.1",
                title: "Enantiomers"
            },
            {
                type: "objective",
                url: "section_7.3.2.html",
                id: "7.3.2",
                title: "Symmetry Elements"
            },
            {
                type: "objective",
                url: "section_7.3.3.html",
                id: "7.3.3",
                title: "Chirality and Symmetry"
            }, 
            {
                type: "objective",
                url: "section_7.3.4.html",
                id: "7.3.4",
                title: "Diastereomers"
            },
            {
                type: "objective",
                url: "section_7.3.5.html",
                id: "7.3.5",
                title: "Meso Compounds"
            },
			{
                type: "objective",
                url: "section_7.3.6.html",
                id: "7.3.6",
                title: "Alkenes and Allenes"
            },
			{
                type: "objective",
                url: "section_7.3.7.html",
                id: "7.3.7",
                title: "Counting Stereoisomers"
            },
            ]
		},
		{
            type: "module",
            url: "module_7.4.html",
            id: "7.4",
            title: "Physical Properties",
            children: [
            {
                type: "objective",
                url: "section_7.4.1.html",
                id: "7.4.1",
                title: "Optical Activity"
            },
            {
                type: "objective",
                url: "section_7.4.2.html",
                id: "7.4.2",
                title: "Racemic, Scalemic, and Enantiopure Samples"
            },
			{
                type: "objective",
                url: "section_7.4.3.html",
                id: "7.4.3",
                title: "Stereochemical Topicity"
            },
            ]
        },
		{
            type: "module",
            url: "module_7.5.html",
            id: "7.5",
            title: "Stereoisomerism, Energy, and Time Scales",
            children: [
            {
                type: "objective",
                url: "section_7.5.1.html",
                id: "7.5.1",
                title: "Conformational and Configurational Stereoisomerism"
            },
            {
                type: "objective",
                url: "section_7.5.2.html",
                id: "7.5.2",
                title: "Stereocenters with Lone Pairs"
            },
			{
                type: "objective",
                url: "section_7.5.3.html",
                id: "7.5.3",
                title: "Stereochemical Stability of Alkenes"
            },
			{
                type: "objective",
                url: "section_7.5.4.html",
                id: "7.5.4",
                title: "Rotamers"
            },
			{
                type: "objective",
                url: "section_7.5.5.html",
                id: "7.5.5",
                title: "Rotamers"
            },
			{
                type: "objective",
                url: "section_7.5.6.html",
                id: "7.5.6",
                title: "Disubstituted Cyclohexanes - A Case of Conformational Stereoisomerism"
            },
			{
                type: "objective",
                url: "section_7.5.7.html",
                id: "7.5.7",
                title: "Low Temperature Isolation of Stereoisomerism"
            },
            ]
		},
		{
            type: "module",
            url: "module_7.6.html",
            id: "7.6",
            title: "Resolution of Enantiomers",
            children: [
            {
                type: "objective",
                url: "section_7.6.1.html",
                id: "7.6.1",
                title: "Resolution by Way of Diastereomer Formation"
            },
            {
                type: "objective",
                url: "section_7.6.2.html",
                id: "7.6.2",
                title: "Enzymatic Resolution"
            },
			{
                type: "objective",
                url: "section_7.6.3.html",
                id: "7.6.3",
                title: "Chromatographic Resolution"
            },
			{
                type: "objective",
                url: "section_7.6.4.html",
                id: "7.6.4",
                title: "Spontaneous Resolution"
            },
            ]
		},
        ]
    }
    ]
};


function tierDelve(tier, parent, root, ignore) {
    tier._parent = parent;
    root._lTiers.push(tier);

    ignore = ignore || tier.ignore;
    tier.ignore = ignore; // inherit sins of the father

    if (tier.children && tier.children.length)
    {
        for (var i = 0; i < tier.children.length; i++)
        {
            var child = tier.children[i];

            if (!child.ordinal) child.ordinal = i+1;
            tierDelve(child, tier, root, ignore);
        }
    }
}

function massageBookConfig(config) {
    config._lTiers = [];

    tierDelve(config, null, config, false);

    config.ordinal = -1;
    var lastGood = null;

    // Establish prev/next for the linear scheme
    for (var i = 0; i < config._lTiers.length; i++) {
        var tier = config._lTiers[i];
        //tier._lIndex = i;

        if (tier.ignore) {
            tier._prev = null;
            tier._next = null;
            continue;
        }

        if (lastGood) lastGood._next = tier;
        tier._prev = lastGood;

        /*
        tier._prev = i
            //&& (config._lTiers[i-1].ordinal != -1) // Comment this out to put TOC at start of list
            ? config._lTiers[i-1] : null;
        tier._next = i < config._lTiers.length - 1 ? config._lTiers[i+1] : null;
        */

        lastGood = tier;
    }

    if (lastGood) {
        // wrap around the list
        lastGood._next = config._lTiers[0];
        config._lTiers[0]._prev = lastGood;
    }
}

function determineCurrentTier(config) {
    // For now we'll key on the filename component

    var shortUrl = window.location.href.substring(window.location.href.lastIndexOf("/")+1); // trailing component

    if (shortUrl.indexOf("#") != -1) shortUrl = shortUrl.substring(0, shortUrl.indexOf("#")); // trim arnchor
    if (shortUrl.indexOf("?") != -1) shortUrl = shortUrl.substring(0, shortUrl.indexOf("?")); // trim query

    for (var i = 0; i < config._lTiers.length; i++) {
        if (shortUrl == config._lTiers[i].url) return config._lTiers[i];
    }

    return null;
}


// Do the actual stuff!

massageBookConfig(bookConfig);
var thisTier = determineCurrentTier(bookConfig); // global scope for use in subsequent js
//alert(thisTier.title);
